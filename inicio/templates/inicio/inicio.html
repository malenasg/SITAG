{% extends 'base.html' %}
{% load static %}

{% block title %}Inicio | SITAG{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'inicio/css/inicio.css' %}">
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
/>

<div class="inicio-header">
  <h1>Bienvenido, {{ user.first_name|default:", usuario" }}</h1>
</div>

<form method="GET" class="filtros">
  <select name="orden">
    <option value="fecha_inicio" {% if request.GET.orden == 'fecha_inicio' %}selected{% endif %}>Ordenar por fecha</option>
    <option value="titulo" {% if request.GET.orden == 'titulo' %}selected{% endif %}>Ordenar por título</option>
  </select>
  
  <select name="localidad">
    <option value="">Filtrar por localidad</option>
    {% for loc in localidades %}
      <option value="{{ loc }}" {% if request.GET.localidad == loc %}selected{% endif %}>{{ loc }}</option>
    {% endfor %}
  </select>
  
  <select name="estado">
    <option value="">Filtrar por estado</option>
    {% for est in estados %}
      <option value="{{ est }}" {% if request.GET.estado == est %}selected{% endif %}>{{ est }}</option>
    {% endfor %}
  </select>
  
  <button type="submit">Aplicar</button>
</form>

<div class="cards-container">
  <div class="card-resumen clientes">
    <h3>Clientes</h3>
    <span class="numero">{{ total_clientes|default:"0" }}</span>
  </div>

  <div class="card-resumen trabajos">
    <h3>Trabajos activos</h3>
    <span class="numero">{{ trabajos_activos|default:"0" }}</span>
  </div>

  <div class="card-resumen pendientes">
    <h3>Pendientes esta semana</h3>
    <span class="numero">{{ trabajos_pendientes|default:"0" }}</span>
  </div>
</div>

<table class="tabla">
  <thead>
    <tr>
      <th>Trabajo</th>
      <th>Descripción</th>
      <th>Fecha de inicio</th>
      <th>Estado</th>
      <th>Cliente asociado</th>
    </tr>
  </thead>
  <tbody>
    {% if trabajos %}
      {% for trabajo in trabajos %}
        <tr>
          <td>{{ trabajo.titulo }}</td>
          <td>{{ trabajo.descripcion }}</td>
          <td>{{ trabajo.fecha_inicio }}</td>
          <td>{{ trabajo.estado }}</td>
          <td>{{ trabajo.cliente.nombre }}</td>
        </tr>
      {% endfor %}
    {% else %}
      <tr><td colspan="5">No hay trabajos recientes</td></tr>
    {% endif %}
  </tbody>
</table>

<script>
  const filtros = document.querySelectorAll('.filtros select');
  filtros.forEach(filtro => {
    filtro.addEventListener('change', () => {
      filtro.form.submit();
    });
  });
</script>

{% endblock %}
