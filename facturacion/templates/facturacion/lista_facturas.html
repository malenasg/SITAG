{% extends 'base.html' %}
{% load static %}

{% block title %}Facturas | SITAG{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'facturacion/css/facturacion.css' %}">

<div class="facturas-header">
    <div class="header-izquierda">
        <h1>Facturas</h1>
    </div>

    <div class="header-derecha">
        <a href="{% url 'facturacion:lista_presupuestos' %}" class="btn-presupuestos">
            Lista de Presupuestos
        </a>
    </div>
</div>

<input type="text" id="searchInput" placeholder="Buscar factura" class="input-busqueda">

<div class="tabla-wrapper">
  <table class="tabla" id="facturasTabla">
    <thead>
      <tr>
        <th>N°</th>
        <th>Trabajo</th>
        <th>Cliente</th>
        <th>Estado</th>
        <th>Opciones</th>
      </tr>
    </thead>
    <tbody>
      {% for factura in facturas %}
        <tr>
          <td>{{ factura.id }}</td>
          <td>{% if factura.presupuesto.trabajo %}{{ factura.presupuesto.trabajo.titulo }}{% else %}—{% endif %}</td>
          <td>
            {% if factura.presupuesto.trabajo and factura.presupuesto.trabajo.cliente %}
              {% if factura.presupuesto.trabajo.cliente.tipo_cliente == 'fisica' %}
                  {{ factura.presupuesto.trabajo.cliente.clientefisico.nombre }} {{ factura.presupuesto.trabajo.cliente.clientefisico.apellido }}
              {% else %}
                  {{ factura.presupuesto.trabajo.cliente.clientejuridico.razon_social }}
              {% endif %}
            {% else %}
              —
            {% endif %}
          </td>
          <td>
            {% if factura.pagada %}
              <span class="estado estado-pagada">Pagada</span>
            {% else %}
              <span class="estado estado-pendiente">Pendiente</span>
            {% endif %}
          </td>
          <td>
            <a href="{% url 'facturacion:detalle_factura' factura.id %}" class="btn-accion btn-detalle">
              <i class="fa-solid fa-eye"></i> Ver
            </a>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="5" style="text-align:center;">No hay facturas cargadas.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script src="{% static 'facturacion/js/listas.js' %}"></script>
{% endblock %}
